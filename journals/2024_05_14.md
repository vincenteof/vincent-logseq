- [[Crypto Roadmap]] [[Uniswap]] v2
	- https://uniswap.org/whitepaper.pdf
	  id:: 66437de8-829f-4193-a48f-033e8bad1b08
	- https://jeiwan.net/posts/programming-defi-uniswapv2-1/
	- {{video https://www.youtube.com/watch?v=nkaZvByFwnY}}
	-
	- 直接支持了 ERC20 的交易对而无需用 ETH 作为桥接
	- 为其他合约提供了更好的价格预言机功能
		- 在 v1 中攻击者可以通过串改池子比例来操纵价格，进而在依赖了 uniswap 的区中心化借贷平台里借出远超出价格的资产，然后在一笔交易中再将池子的比率重置回去
		- v2 更新的预言机价格的时机在下一个区块里
	- 闪电兑换
	- 合约实现细节
		- reverse0 与 reverse1
		- _mint(address(0), MINIMUM_LIQUIDITY);
		- uint112
			- 用这个数据类型主要是为了 gas 优化，减少 state 状态读取次数，涉及 evm 内存分布
		- re-entrancy guard 的实现
		- 价格语言机的实现
			- twap
				- twap 含义
				- unchecked
			- solidity 中浮点数运算
				- 合约中放大，前端应用中处理？
				- 原生并没有浮点数，因此需要去模拟，可以采用两个更小精度的单位，一个存储整数部分，一个存储小数部分
				- uq112.112 表示 112 位整数，112位小数
		- 整数上溢下溢出
			- solidity 0.8 之前不做检查因此需要 safeMath
			- 乘法比较容易出现溢出，在合约里用 uint112 存 reserve 虽然可以优化 gas，但是让整个合约能处理的最大资金数变小了？
		- safeTransfer
			-
			- 因为转账依赖于第三方 ERC20 的支持，而这是无法控制的，为了健壮性我们可以只按照标准 ERC20 的定义出处理，不满足就直接 revert 合约自己定义的 error
			- 可以使用 `call` ，在没有 abi 的时候只需要传入方法的字符串定义，然后手动解析返回值
- [[Crypto Roadmap]] [[mev]] 综述
	- https://biquanlibai.notion.site/MEV-0069872a7241476f82bf5f7a4e1068ea
	- https://mp.weixin.qq.com/s/Yd-umFnjhXyB7crei2lynA
	- mev 指矿工通过改变交易顺序或插入交易来获利，因为交易在 mempool 是公开的。
	- 一些常用 mev 技术手段：
		- front running：抢先交易，比如有人在做 dex 间的价差套利，在低价 dex 放出大额买单，被抢先会原本的交易会失败或产生巨大滑点
		- back running：看到交易影响巨大的交易，抢在别人钱搬砖搬平
		- sandwich attack：
		- time-bandit attack：
	- 从应用而言主要是：
		- dex 套利及借贷应用的清算
	- 特性：
		- dex 套利
			- 单笔交易允许多个交易对之间的套利
			- 利用闪电贷无需本金，只需要一些 gas
		- 清算
			- 本身是超额抵押达到，阈值以后任意用户发起清算，通常是机器人
			- 清算是多次的，不像中心化交易所
	- 影响：
		- 保证了链上各种资产价格的实时性
		- 容易造成 gas war，造成 gas 极具上升不稳定，而且也容易造成各种失败交易上链
		- 容易造成链分叉，影响区块链终局性
	- 一些负面影响的解决方案
		- EIP-1559
			- 使得 gas 价格变化更平缓
			- 增加了矿工插入交易的成本，减少矿工 mev
		- 中心化 sequencer（flashbots）
			- gas war 被放到了链下
				- 通过在 tx 内部直接支付 ETH 给 miner 进行 bid
				- 中心化服务完成 auction，确定要包含的交易及排序
				- 失败交易不上链
			- 提供了 private mempool，防止了黑暗森林
		- rollup 引入了 fcfs 的 sequencer，使用 rollup 可以防止 mev